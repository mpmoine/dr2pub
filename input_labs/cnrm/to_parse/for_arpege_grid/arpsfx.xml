<!-- 
Example of XIOS-2.0 xml sub-file for Surfex + Arpege
First version - 08/2016 - Stephane Senesi 

This file must be sourced by main XIOS xml file (iodef.xml) , using a
tag 'context id=surfex' 

It references a series of other files, one per topic

Ref: 
  - for XIOS : https://forge.ipsl.jussieu.fr/ioserver/wiki 
  - for XIAS (implementation in Surfex and Arpege) : http://www.cnrm-game-meteo.fr/cm/spip.php?article60
-->

<context id="surfex">
  
  <variable_definition>
    <!-- Year of time origin for NetCDF files; defaults to 1850 -->
    <variable id="ref_year" type="int"> 1850 </variable>
   
    <!-- Next default value applies when field have no freq_op -->
    <variable id="timesteps_between_samples" type="int">1</variable>
    
    <!-- A few variables used for unit conversion -->
    <variable id="coeffl"  type="float">2.5008E+6</variable> 
    <variable id="coefflf" type="float">2.8345E+6</variable> 
    <variable id="gravit" type="float">9.81</variable> 
  </variable_definition> 

  <!-- 
       Note on references to other configuration files 
       With Eclis you can either : 
	 - quote a full pathname
         - or use pattern "./file.xml" and quote the corresponding file
	 full pathname in OTHER_FILES (with same basename); ECLIS 
	 will then bring the files in the rundir   --> 

  <!-- On purpose, we define and source a cascade of secondary files 
       for the sake of modularity (but at the expense of scattering
       the material -->
  <field_definition  src="./surfex_fields.xml"/>

  <!-- First, we insert a 'stable' file which complements 
       declarations of fields done by Surfex code 
       This allow to reference all fields in all cases, avoiding crashes -->

  <!-- For allowing to also request any Arpege basic or derived field,
       insert relevant declarations -->
  <field_definition  src="./arpege_fields.xml"/>

  <!-- Next we include some translations of variable names, and some 
       derived variables definitions (later referenced in file definitions) -->

  <!-- You should activate/de-activate field groups and files by
       changing next file or changing toggles in it  -->
  <file_definition  src="./arpsfx_files.xml"/>


  <domain_definition>
    <domain id="FULL" prec="8" />
    <!-- Define an output grid, here a regular lat-lon grid matching the T127 resolution -->
    <domain id="regular_256" ni_glo="256" nj_glo="128"
	    type="rectilinear"  prec="8">
      <generate_rectilinear_domain/>
      <interpolate_domain order="1" renormalize="true" /> <!-- write_weight="false" /-->
    </domain>
    <domain id="complete"  prec="8">
      <interpolate_domain order="1" renormalize="true"/> <!-- write_weight="true" /-->
    </domain>
  </domain_definition>


  <axis_definition>
    <!-- Arpege -->
    <axis id="klev"  prec="8"/>
    <axis id="klev_half"  prec="8"/>
    <axis id="klev_ll" axis_ref="klev"> <zoom_axis begin="90" n="1"/> </axis>
    
    <!-- Generic pressure axis -->
    <axis id="paxis" unit="Pa" name="p" standard_name="pressure" positive="down"   prec="8">
       <interpolate_axis type="polynomial" order="1" coordinate="pa"/>
    </axis>
    
    <!-- Standard pressure levels sets -->
    <axis id="pstd" axis_ref="paxis" n_glo="24"  prec="8"
	  value="(0,23)[100000. 92500. 85000. 70000. 60000. 50000. 40000. 30000. 25000. 20000. 15000. 10000. 7000. 5000. 3000. 2000. 1000. 500. 300. 100. 10. 5. 1.]" />

    <!-- Surfex -->
    <axis id="patch" prec="8"/>
    <axis id="patches" prec="8"/>
    <axis id="snow_layer" prec="8"/>
    <axis id="swband"  prec="8"/>
    <axis id="ground_layer" prec="8"/>
    <axis id="ground_layer_for_temperature" prec="8"/>
    <axis id="soil_carbon_pools" prec="8"/>
    <axis id="landusetype4" prec="8"/>
    <axis id="vegtype" prec="8"/>
    <axis id="snow_patch" prec="8"/>
    <axis id="seaice_layer" prec="8"/>

  </axis_definition>

  <grid_definition>
    <grid id="FULL_grid"> <domain domain_ref="FULL"/> </grid>
    <grid id="FULL_klev"> <domain domain_ref="FULL"/> <axis axis_ref="klev"/> </grid>
    <grid id="NATURE_grid"> <domain domain_ref="NATURE"/> </grid>
    <grid id="SEA_grid"> <domain domain_ref="SEA"/> </grid>
    <grid id="WATER_grid"> <domain domain_ref="WATER"/> </grid>
    <grid id="TOWN_grid"> <domain domain_ref="TOWN"/> </grid>
  </grid_definition>

</context>
